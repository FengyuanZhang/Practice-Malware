import socket
from signal import signal, SIGPIPE, SIG_DFL
signal(SIGPIPE, SIG_DFL)
import os

PATH = ''
TARGET = []
HOST = ''
PORT = 8080


def read_picture():
    # I try to use read() function to read the file at one time but the send picture alway throw error.
    # So I decide to read line by line
    source = open(PATH, 'rb')
    for line in source:
        TARGET.append(line)

def socket_image():
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.bind((HOST, PORT))
    print('Local set down, waitting for connection')
    s.listen(1)
    connection, address = s.accept()
    send_image(connection, address)
    print('Finish.')

def send_image(connection, address):
    print('Sending......')
    for t in TARGET:
        connection.sendall(t)



if __name__ == '__main__':
    PATH = '/home/kali/Desktop/index.jpeg'
    read_picture()
    socket_image()
